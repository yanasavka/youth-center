<!doctype html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Youth Center</title>
    <link rel="stylesheet" href="global.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
</head>
<body>
<header th:insert="~{blocks/header.html :: header}">
</header>
<div class="container mt-2">
    <a href="/users" class="btn btn-close close-link" aria-label="Close"></a><br>
    <h2 th:text="${user.name} + ' ' + ${user.surname} + ' Posts'"></h2>
        <div class="p-3" th:each="post, postIndex : ${posts}" th:id="'post-'+${post.id}">
            <div th:each="image : ${post.images}" class="images">
                <img class="post-img" th:src="'/images/' + ${image.id}" alt="" height="260px">
            </div>
            <p th:text="${post.content}"></p>
            <p class="text-muted"><b>Дата створення:</b> <small th:text="${#temporals.format(post.createdAt, 'dd-MM-yyyy HH:mm:ss')}"></small></p>
            <div class="my-btn-group">
                <a class="btn btn-success" th:href="'/posts/' + ${post.id} + '/edit'">Редагувати</a>
                <form th:action="'/posts/' + ${post.id} + '/remove'" method="post">
                    <button class="btn btn-dark" type="submit">Видалити</button>
                </form>
            </div>
            <button class="like-button" th:onclick="'likePost(' + ${post.id} + ',' + ${user.id} + ')'">
                Вподобайка <span class="total-likes" th:text="${post.totalLikes}"></span>
            </button>
            <textarea placeholder="Додати коментар"></textarea>
            <hr th:if="${postIndex.index != posts.size() - 1}" />
        </div>
</div>
<div th:insert="~{blocks/footer.html :: footer}"></div>
<script>
    function likePost(postId) {
        fetch(`/users/ userId /posts`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ postId: postId })
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                // Оновлюємо значення totalLikes на сторінці
                const postElement = document.getElementById(`post-${postId}`);
                const totalLikesElement = postElement.querySelector('.total-likes');

                // Збільшуємо лічильник лайків
                totalLikesElement.innerText = parseInt(totalLikesElement.innerText) + 1;
            })
            .catch(error => {
                console.error('There was a problem with your fetch operation:', error);
            });
    }
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</body>
</html>